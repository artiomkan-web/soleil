"use strict";window.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll("section"),r=0,t=!0,l={price:{items:[],main:null,delivery:null,all:null},email:null,address:{index:null,country:null,region:null,city:null,street:null,building:null,apartment:null,full:null},delivery:null,card:{number:null,owner:null,date:null,cvc:null}},n=document.querySelector(".information"),o=n.querySelector("#information_email"),i=n.querySelectorAll(".form__input"),c=n.querySelectorAll(".form .dropdown"),a=n.querySelectorAll(".form .dropdown__title"),d=[],s=n.querySelector("button._continue"),u=document.querySelector("section.delivery"),y=u.querySelector("#delivery_email"),_=u.querySelector("#delivery_geo"),m=u.querySelector("#delivery_main_price"),v=u.querySelector(".methods__list"),p=v.querySelectorAll(".methods__item"),S=u.querySelector("#delivery_delivery_price"),q=u.querySelector("button._continue"),f=u.querySelector("button._return"),L=document.querySelector("section.payment"),h=L.querySelector("#payment_main_price"),g=L.querySelector("#payment_delivery_price"),E=L.querySelector("#payment_email"),b=L.querySelector("#payment_geo"),x=L.querySelector("#payment_delivery"),M=L.querySelector("#payment_card_number"),C=L.querySelector("#payment_card_owner"),T=L.querySelector("#payment_card_date"),k=L.querySelector("#payment_card_cvc"),w=L.querySelector("button._continue"),H=L.querySelector("button._return"),A=document.querySelector("section.success"),N=A.querySelector("#success_main_price"),D=A.querySelector("#success_delivery_price"),I=A.querySelector("#success_email"),O=A.querySelector("#success_geo"),V=A.querySelector("#success_delivery");function z(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value)?(e.parentNode.classList.remove("_error"),!0):(e.parentNode.classList.add("_error"),e.scrollIntoView({behavior:"smooth",block:"center"}),!1)}function Z(e,r,t=1){return(r+="").length<t?(e.parentNode.classList.add("_error"),e.scrollIntoView({behavior:"smooth",block:"center"}),!1):(e.parentNode.classList.remove("_error"),!0)}function j(e,r){return e.querySelector("span").textContent==r?(e.parentNode.classList.add("_error"),e.scrollIntoView({behavior:"smooth",block:"center"}),!1):(e.parentNode.classList.remove("_error"),!0)}function B(e){if(4==(e+="").length){let r=e.slice(0,1),t=e.slice(-3);e=r+"."+t}else if(5==e.length){let r=e.slice(0,-3),t=e.slice(-3);e=r+"."+t}else if(6==e.length){let r=e.slice(0,-3),t=e.slice(-3);e=r+"."+t}else if(7==e.length){let r=e.slice(0,1),t=e.slice(1,-3),l=e.slice(-3);e=r+"."+t+"."+l}return e}function F(){r>e.length-1||r<0||(e.forEach(e=>{e.classList.remove("_active")}),e[r].classList.add("_active"),window.scrollTo({top:0,behavior:"smooth"}))}o.addEventListener("input",()=>{z(o)}),a.forEach(e=>{e=e.querySelector("span"),d.push(e.textContent)}),c.forEach(e=>{let r=e.querySelector(".dropdown__title");e.querySelectorAll(".dropdown__item").forEach(e=>{e.addEventListener("click",()=>{r.parentNode.classList.remove("_error")})})}),i.forEach(e=>{e.addEventListener("input",()=>{Z(e,e.value)})}),s.addEventListener("click",()=>{t=!0,i.forEach(e=>{Z(e,e.value),!Z(e,e.value)&&(t=!1)});for(let e=0;e<a.length;e++){let r=a[e],l=d[e];j(r,l),!j(r,l)&&(t=!1)}z(o),!z(o)&&(t=!1),t&&(l.price.main=1*document.querySelector("#information_main_price").textContent.replace(/[^0-9]/g,""),l.email=document.querySelector("#information_email").value,l.address.index=document.querySelector("#information_index").value,l.address.country=document.querySelector("#information_country").textContent.replace(/\s{2,}/g,""),l.address.region=document.querySelector("#information_region").textContent.replace(/\s{2,}/g,""),l.address.city=document.querySelector("#information_city").value,l.address.street=document.querySelector("#information_street").value,l.address.building=document.querySelector("#information_building").value,l.address.apartment=document.querySelector("#information_apartment").value,l.address.full=l.address.index+", "+l.address.country+", "+l.address.region+" обл., "+l.address.city+", "+l.address.street+", "+l.address.building+", "+l.address.apartment,m.innerHTML=B(l.price.main)+" руб.",y.innerHTML=l.email,_.innerHTML=l.address.full,r++,F())}),q.addEventListener("click",()=>{t=!0,z(y),!z(y)&&(t=!1),Z(_,_.value),!Z(_,_.value)&&(t=!1),t&&(l.delivery=u.querySelector(".delivery__methods ._active .methods__name").textContent,l.price.delivery=1*u.querySelector(".delivery__methods ._active .methods__price").textContent.replace(/[^0-9]/g,""),l.address.full=u.querySelector("#delivery_geo").value,l.email=u.querySelector("#delivery_email").value,h.innerHTML=l.price.main,g.innerHTML=l.price.delivery,E.innerHTML=l.email,b.innerHTML=l.address.full,x.innerHTML=l.delivery+", "+B(l.price.delivery)+" руб.",r++,F())}),f.addEventListener("click",()=>{r--,F()}),v.addEventListener("click",()=>{p.forEach(e=>{if(e.classList.contains("_active")){let r=e.querySelector(".methods__name"),t=e.querySelector(".methods__price");l.delivery=r.textContent,l.price.delivery=1*t.textContent.replace(/[^0-9]/g,""),S.innerHTML="+"+B(l.price.delivery)+" руб."}})}),w.addEventListener("click",()=>{t=!0,Z(M,M.value),!Z(M,M.value)&&(t=!1),Z(C,C.value),!Z(C,C.value)&&(t=!1),Z(T,T.value),!Z(T,T.value)&&(t=!1),Z(k,k.value),!Z(k,k.value)&&(t=!1),Z(b,b.value),!Z(b,b.value)&&(t=!1),z(E),t&&(N.innerHTML=l.price.main,D.innerHTML=l.price.delivery,I.innerHTML=l.email,O.innerHTML=l.address.full,V.innerHTML=l.delivery+", "+B(l.price.delivery)+" руб.",l.card.number=M.value,l.card.owner=C.value,l.card.date=T.value,l.card.cvc=k.value,r++,F())}),H.addEventListener("click",()=>{r--,F()}),$(M).mask("9999 9999 9999 9999"),$(T).mask("99/99"),$(k).mask("999"),document.querySelectorAll(".order").forEach(e=>{let r=e.querySelector(".order_title_price"),t=e.querySelector(".order_main_price"),l=e.querySelector(".order_delivery_price"),n=e.querySelector(".order_total_price");function o(){r.textContent=n.textContent=B(1*t.textContent.replace(/[^0-9]/g,"")+1*l.textContent.replace(/[^0-9]/g,""))+" руб."}t.addEventListener("DOMSubtreeModified",o),l.addEventListener("DOMSubtreeModified",o)}),document.querySelectorAll(".details").forEach(e=>{e.querySelectorAll(".details__item").forEach(e=>{let r=e.querySelector(".details__change"),t=!1;r&&r.addEventListener("click",()=>{let l=e.querySelector(".details__value");function n(){e.classList.remove("_edit"),e.classList.add("_error"),t=!t}function o(){e.classList.remove("_edit"),e.classList.remove("_error"),l.style.pointerEvents="none",r.textContent="Изменить"}t=!t,t?(e.classList.add("_edit"),l.style.pointerEvents="auto",r.textContent="Готово"):(l.classList.contains("_destination")&&(l.value.length>0?o():n()),l.classList.contains("_email")&&(z(l)?o():n()))})})})});